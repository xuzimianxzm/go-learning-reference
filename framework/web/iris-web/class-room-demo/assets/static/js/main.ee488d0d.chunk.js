(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{11:function(e,t){var a="pro",n="http://localhost:8888",s="",o="/v1",r="/message",c="/user",i="/token/info",l="/login";function u(){return("dev"==a?n:s)+o}e.exports={UserURL:function(){return u()+c},TokenInfoURL:function(){return u()+i},LoginURL:function(){return u()+l},MessageURL:function(){return u()+r}}},32:function(e,t,a){},37:function(e,t,a){e.exports=a(73)},42:function(e,t,a){},60:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},61:function(e,t,a){},63:function(e,t,a){},64:function(e,t,a){},66:function(e,t,a){},67:function(e,t,a){},73:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),o=a(33),r=a.n(o);a(42),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=a(13),i=a(14),l=a(2),u=a(3),m=a(5),p=a(4),g=a(6),d=a(10),f=a.n(d),h=(a(60),a(61),a(36)),v=a(17),b=a.n(v),E=(a(63),function(e){function t(e){return Object(l.a)(this,t),Object(m.a)(this,Object(p.a)(t).call(this,e))}return Object(g.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"message"},s.a.createElement("div",{className:"message-time"},b.a.unix(this.props.msgInfo.sendTime).format("YYYY-MM-DD HH:mm")),s.a.createElement("div",{className:this.props.msgInfo.private?"message-sender private":"message-sender"},this.props.msgInfo.senderName," :"),s.a.createElement("div",{className:"message-content"},s.a.createElement("span",{className:"message-content-content"},this.props.msgInfo.content," ")))}}]),t}(s.a.Component)),N=a(11),O=a.n(N),k=(a(64),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).componentWillMount=function(){var e=setInterval((function(){a.state.logged&&f.a.get("".concat(O.a.MessageURL()),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("iris-token"))},params:{beginTime:b()().subtract(2,"days").format("X"),endTime:0,beginId:a.state.lastMsgId}}).then((function(e){var t=a.state.lastMsgId;console.log(" => ",t);var n=e.data,s=n.length,o=Object(h.a)(a.state.msgList);n.forEach((function(e){o.push(e)})),a.setState({logged:!0,msgList:o,lastMsgId:0===s?t:n[s-1].id})})).catch((function(e){switch(console.log("\u6d88\u606f\u7ec4\u4ef6\u83b7\u53d6\u6d88\u606f\u5931\u8d25 => ",e.response.data),a.setState({logged:!1}),e.response.status){case 401:alert("\u767b\u5f55\u72b6\u6001\u5931\u6548\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\uff01"),a.props.history.push("/signin"),clearTimeout(a.state.timerId)}}))}),700);a.setState({timerId:e})},a.componentWillUnmount=function(){clearTimeout(a.state.timerId)},a.state={logged:!1,timerId:0,lastMsgId:0,msgList:[]},a}return Object(g.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(){this.refs["msg-container"].scrollIntoView({behavior:"smooth",block:"end"})}},{key:"render",value:function(){return s.a.createElement("div",{className:"msg-container",ref:"msg-container"},this.state.msgList.map((function(e,t){return s.a.createElement(E,{key:t,msgInfo:e})})))}}]),t}(s.a.Component)),j=a(19),I=a.n(j),y=(a(66),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).sendMsg=function(){var e,t,n,s,o;return I.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=a.refs.receiverName.value,t=a.refs.content.value,r.next=4,I.a.awrap(f.a.get("".concat(O.a.UserURL()),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("iris-token"))}}));case 4:if(200!==(o=r.sent).status){r.next=10;break}n=o.data,console.log("\u83b7\u53d6\u7528\u6237\u5217\u8868\u6210\u529f => ",n),r.next=12;break;case 10:return alert("\u53d1\u9001\u5931\u8d25\uff1a\u83b7\u53d6\u7528\u6237\u5217\u8868\u5931\u8d25\u3002"),r.abrupt("return");case 12:if(""===e?s=0:n.forEach((function(t){t.username===e&&(s=t.id,console.log("\u6210\u529f\u83b7\u53d6\u63a5\u53d7\u8005\u4fe1\u606f => ",t))})),void 0!==s){r.next=16;break}return alert("\u53d1\u9001\u5931\u8d25\uff1a\u65e0\u6cd5\u627e\u5230\u7528\u6237\u540d\u4e3a".concat(e,"\u7684\u63a5\u53d7\u8005")),r.abrupt("return");case 16:if(""!==t){r.next=19;break}return alert("\u53d1\u9001\u5931\u8d25\uff1a\u4f60\u4e0d\u80fd\u53d1\u9001\u7a7a\u6d88\u606f"),r.abrupt("return");case 19:console.log("\u6b63\u5728\u7ed9id\u4e3a=>".concat(s,"\u7684\u7528\u6237\u53d1\u9001\u6d88\u606f=>").concat(t)),f.a.post("".concat(O.a.MessageURL()),{receiverId:s,content:t},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("iris-token"))}}).then((function(e){console.log("\u53d1\u9001\u6210\u529f => ",e),a.refs.content.value=""})).catch((function(e){console.log("\u53d1\u9001\u5931\u8d25 => ",e.response.data)}));case 21:case"end":return r.stop()}}))},a.logout=function(){console.log("\u6b63\u5728\u6ce8\u9500\u7528\u6237"),console.log("\u6b63\u5728\u6e05\u9664localStroage"),localStorage.removeItem("iris-token"),console.log("\u6e05\u9664localStroage\u6210\u529f\uff0c\u5b8c\u6210\u6ce8\u9500"),window.location.reload()},console.log(e),a}return Object(g.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"sendbox"},s.a.createElement("div",{className:"sendbox-sendto"},s.a.createElement("button",{className:"sendbox-sendto-sender",onClick:this.logout},this.props.userInfo.username),s.a.createElement("div",{className:"sendbox-sendto-charto"},"to"),s.a.createElement("input",{className:"sendbox-sendto-receiver",placeholder:"All",ref:"receiverName"})),s.a.createElement("div",{className:"sendbox-msg"},s.a.createElement("input",{className:"sendbox-msg-input",placeholder:"\u8bf7\u8f93\u5165\u6d88\u606f\u5185\u5bb9",ref:"content"}),s.a.createElement("button",{className:"sendbox-msg-button",onClick:this.sendMsg},"\u53d1\u9001")))}}]),t}(s.a.Component)),w=(a(67),function(e){function t(e){return Object(l.a)(this,t),Object(m.a)(this,Object(p.a)(t).call(this,e))}return Object(g.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"sign"},s.a.createElement(c.b,{to:"/signin"},s.a.createElement("button",{className:"sign-in"},"\u767b\u5f55")),s.a.createElement(c.b,{to:"/signup"},s.a.createElement("button",{className:"sign-up"},"\u6ce8\u518c")))}}]),t}(s.a.Component)),L=(a(32),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).login=function(){var e=a.refs.username.value,t=a.refs.passwd.value;console.log(e,t),f.a.post("".concat(O.a.LoginURL()),{username:e,passwd:t}).then((function(e){alert("\u767b\u5f55\u6210\u529f"),console.log("\u767b\u5f55\u6210\u529f => ",e),localStorage.setItem("iris-token",e.data.token),console.log("\u5df2\u7ecf\u5c06\u767b\u5f55\u83b7\u5f97\u7684token\u5b58\u5165localStorage"),a.props.history.push("")})).catch((function(e){alert("\u767b\u5f55\u5931\u8d25".concat(JSON.stringify(e.response.data))),console.log("\u767b\u5f55\u5931\u8d25 => ",e.response.data)}))},a}return Object(g.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"page-sign-in"},s.a.createElement("div",{className:"page-header"},"\u767b\u5f55"),s.a.createElement("div",{className:"page-content"},s.a.createElement("div",{className:"input-title"},"\u7528\u6237\u540d"),s.a.createElement("input",{className:"input-area",ref:"username"}),s.a.createElement("div",{className:"input-title"},"\u5bc6\u7801"),s.a.createElement("input",{className:"input-area",ref:"passwd",type:"password"}),s.a.createElement("div",{className:"input-button"},s.a.createElement("button",{className:"input-button-ok",onClick:this.login},"\u767b\u5f55"),s.a.createElement(c.b,{to:"/"},s.a.createElement("button",{className:"input-button-return"},"\u8fd4\u56de")))))}}]),t}(s.a.Component)),x=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).register=function(){var e=a.refs.username.value,t=a.refs.passwd.value,n=a.refs.gender.value,s=a.refs.age.value,o=a.refs.interest.value;f.a.post("".concat(O.a.UserURL()),{username:e,passwd:t,gender:n,age:s,interest:o}).then((function(e){alert("\u6ce8\u518c\u6210\u529f"),console.log("\u6ce8\u518c\u6210\u529f => ",e),a.props.history.push("/signin")})).catch((function(e){alert("\u6ce8\u518c\u5931\u8d25".concat(JSON.stringify(e.response.data))),console.log("\u6ce8\u518c\u5931\u8d25 => ",e.response.data)}))},a}return Object(g.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"page-sign-up"},s.a.createElement("div",{className:"page-header"},"\u6ce8\u518c"),s.a.createElement("div",{className:"page-content"},s.a.createElement("div",{className:"input-title"},"\u7528\u6237\u540d"),s.a.createElement("input",{className:"input-area",ref:"username"}),s.a.createElement("div",{className:"input-title"},"\u5bc6\u7801"),s.a.createElement("input",{className:"input-area",ref:"passwd"}),s.a.createElement("div",{className:"input-title"},"\u6027\u522b"),s.a.createElement("select",{className:"input-area",ref:"gender"},s.a.createElement("option",{value:"1"},"\u5973"),s.a.createElement("option",{value:"2"},"\u7537")),s.a.createElement("div",{className:"input-title"},"\u5e74\u9f84"),s.a.createElement("input",{className:"input-area",ref:"age"}),s.a.createElement("div",{className:"input-title"},"\u5174\u8da3\u7231\u597d"),s.a.createElement("input",{className:"input-area",ref:"interest"}),s.a.createElement("div",{className:"input-button"},s.a.createElement("button",{className:"input-button-ok",onClick:this.register},"\u6ce8\u518c"),s.a.createElement(c.b,{to:"/"},s.a.createElement("button",{className:"input-button-return"},"\u8fd4\u56de")))))}}]),t}(s.a.Component),S=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).isLogged=function(){f.a.get("".concat(O.a.TokenInfoURL()),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("iris-token"))}}).then((function(e){console.log("\u9a8c\u8bc1\u767b\u5f55token\u6210\u529f =>",e),a.setState({logged:!0,userInfo:e.data}),a.refs.MsgContent.setState({logged:!0})})).catch((function(e){console.log("\u9a8c\u8bc1\u767b\u5f55token\u5931\u8d25 => ",e.response.data),a.refs.MsgContent.setState({logged:!1}),clearTimeout(a.state.timerId)}))},a.componentWillMount=function(){console.log("componentWillMount");var e=setInterval((function(){a.isLogged()}),5e3);a.setState({timerId:e})},a.componentWillUnmount=function(){clearTimeout(a.state.timerId)},console.log(a.props),a.state={userInfo:null,logged:!1,msgList:[],timerId:0},a.isLogged(),a}return Object(g.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement("div",{className:"app-header"},"\u5728\u7ebf\u804a\u5929\u5ba4"),s.a.createElement("div",{className:"app-content"},s.a.createElement(k,{history:this.props.history,ref:"MsgContent"})),s.a.createElement("div",{className:"app-bottom"},this.state.logged?s.a.createElement(y,{userInfo:this.state.userInfo,ref:"SendBox"}):s.a.createElement(w,null)))}}]),t}(s.a.Component);r.a.render(s.a.createElement(c.a,null,s.a.createElement(i.c,null,s.a.createElement(i.a,{path:"/signin",component:L}),s.a.createElement(i.a,{path:"/signup",component:x}),s.a.createElement(i.a,{path:"/",component:S}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[37,1,2]]]);
//# sourceMappingURL=main.ee488d0d.chunk.js.map